<!--
Sync Impact Report:
- Version change: [NEW] → 1.0.0
- Added sections: Core Principles (5), Platform Standards, Development Workflow, Governance
- Templates requiring updates: ✅ All templates compatible with new constitution
- Follow-up TODOs: None - all placeholders filled
-->

# ExecuTorch Flutter Constitution

## Core Principles

### I. Test-First Development (NON-NEGOTIABLE)
Test-Driven Development is mandatory for all features and bug fixes. Tests MUST be written and approved before implementation begins. The Red-Green-Refactor cycle is strictly enforced: failing tests → minimal implementation → refactoring. All API contracts generated by Pigeon MUST have corresponding failing tests before native implementation. No code ships without comprehensive test coverage including unit, integration, and platform-specific tests.

### II. Platform Parity and Performance
Flutter plugin MUST provide identical behavior and performance characteristics across Android and iOS platforms. Performance targets are non-negotiable: model loading <200ms for 100MB models, inference <50ms for typical mobile models, memory overhead <100MB during execution. Any platform-specific optimizations MUST be documented and justified. ExecuTorch integration MUST use official libraries (Android AAR, iOS frameworks) to ensure compatibility and support.

### III. Type-Safe Cross-Platform Communication
All communication between Dart and native platforms MUST use Pigeon-generated type-safe interfaces. Manual method channel implementations are prohibited. Data serialization errors MUST be caught at compile time, not runtime. Native platform code MUST handle all ExecuTorch operations asynchronously to prevent UI blocking. Error handling MUST be structured with specific exception types for different failure categories.

### IV. Documentation and Example-Driven Development
Every API change MUST be accompanied by updated documentation in both README.md and quickstart guides. Working examples in the `/example` directory MUST demonstrate all major use cases. API documentation MUST include performance characteristics, error conditions, and platform-specific considerations. Before implementation, verify latest ExecuTorch documentation using Context7 to ensure compatibility with current best practices.

### V. Resource Management and Memory Safety
Model lifecycle management is critical: explicit loading, usage tracking, and disposal patterns MUST be enforced. Memory leaks on model disposal are considered critical bugs. Native platforms MUST implement proper resource cleanup using platform-appropriate patterns (ARC for iOS, explicit cleanup for Android). Large model support (>500MB) MUST use memory mapping or streaming approaches to prevent OOM conditions.

## Platform Standards

### ExecuTorch Integration Requirements
All ExecuTorch integration MUST follow official documentation and use stable releases. Android implementation MUST use ExecuTorch AAR 0.6.0+ with proper dependency management through Gradle. iOS implementation MUST use ExecuTorch frameworks built via `build_apple_frameworks.sh` script. Custom ExecuTorch compilation is prohibited - use official pre-built libraries only. Platform-specific optimizations (XNNPACK, quantization) MAY be exposed through optional configuration parameters.

### API Design Standards
Async/await pattern is mandatory for all model operations. Synchronous APIs that could block the UI thread are prohibited. All methods MUST include proper timeout handling and cancellation support. Error messages MUST be user-friendly and include sufficient context for debugging. API surface MUST be minimal - avoid exposing ExecuTorch implementation details to Flutter developers.

### Security and Validation
Model file validation MUST occur before loading - check file format, size constraints, and basic integrity. Input tensor validation MUST verify shape, data type, and size compatibility before inference. Sandbox compliance is mandatory - respect platform security models and file access restrictions. No sensitive information may be logged or exposed through error messages.

## Development Workflow

### Specification-Driven Process
All features MUST follow the /specify → /plan → /tasks → implementation workflow. No implementation begins without approved specifications and design documents. Constitutional compliance checks are required at planning phase and before implementation completion. Feature branches MUST include comprehensive specifications in the `specs/` directory.

### Quality Gates
Pre-commit hooks MUST verify code formatting, basic syntax, and test execution. All PRs require constitutional compliance verification and performance regression testing. Platform-specific testing MUST include real device validation, not just emulator/simulator. Integration tests MUST use actual ExecuTorch models, not mocked interfaces.

### Continuous Integration Requirements
CI pipeline MUST test both Android and iOS platforms with real ExecuTorch models. Performance benchmarks MUST be tracked and regression alerts configured. Documentation updates MUST be verified for accuracy and completeness. Example applications MUST build and run successfully on CI infrastructure.

## Governance

### Amendment Process
Constitution changes require documentation of impact, approval from maintainers, and migration plan for existing code. Major changes (breaking principles) require MAJOR version increment. Minor changes (new principles, expanded guidance) require MINOR version increment. Clarifications and corrections require PATCH version increment.

### Compliance Review
All pull requests MUST verify compliance with constitutional principles. Code reviews MUST specifically check for test-first violations, platform parity issues, and performance regressions. Non-compliance findings MUST be addressed before merge - no exceptions for deadlines or convenience.

### Complexity Management
Complexity that violates simplicity principles MUST be justified in design documents. Alternative simpler approaches MUST be evaluated and rejection rationale documented. Technical debt resulting from complexity MUST be tracked and prioritized for future refactoring. Use CLAUDE.md for ongoing development guidance and context preservation.

**Version**: 1.0.0 | **Ratified**: 2025-09-20 | **Last Amended**: 2025-09-20